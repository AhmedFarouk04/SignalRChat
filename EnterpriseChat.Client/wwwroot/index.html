<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat.Client</title>
    <base href="/" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link href="EnterpriseChat.Client.styles.css" rel="stylesheet" />
</head>
<body>
    <div id="app">
        <div class="loading-screen">
            <svg class="loading-progress">
                <circle r="40%" cx="50%" cy="50%" />
                <circle r="40%" cx="50%" cy="50%" />
            </svg>
            <div class="loading-progress-text"></div>
        </div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>

    <script src="_framework/blazor.webassembly.js"></script>

    <script type="module">
        import { scrollToBottom, scrollToBottomSmooth, isAtBottom, registerRoomsSearchShortcuts } from './js/scroll.js';
        import { registerEscape, unregisterEscape } from './js/keyboard.js';
        import { downloadFileFromStream } from './js/download.js';
        import * as chatInput from './js/chatInput.js';
        import { initNotifySound, playNotify, unlockNotify } from './js/notify.js';
        import { registerClickHandler, unregisterClickHandler } from './js/clickHandler.js';
        import './js/chat-utils.js';

        // âœ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¯ÙˆØ§Ù„ Ø¹Ù„Ù‰ window
        window.chatInsertNewline = chatInput.chatInsertNewline || chatInsertNewline;
        window.chatFocus = window.focusElement || chatInput.focusEl || chatInput.focus;

        window.scrollToBottom = scrollToBottom;
        window.scrollToBottomSmooth = scrollToBottomSmooth;
        window.isAtBottom = isAtBottom;
        window.registerRoomsSearchShortcuts = registerRoomsSearchShortcuts;

        window.registerEscape = registerEscape;
        window.unregisterEscape = unregisterEscape;

        window.downloadFileFromStream = downloadFileFromStream;

        // âœ… Ø§Ù„Ø£Ù‡Ù…: ØªØ¹ÙŠÙŠÙ† Ø¯ÙˆØ§Ù„ Ø§Ù„ØµÙˆØª Ø¹Ù„Ù‰ window
        window.initNotifySound = initNotifySound;
        window.notifyUnlock = unlockNotify;
        window.notifyPlay = playNotify;

        // âœ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙˆØª ÙÙˆØ±Ø§Ù‹
        window.initNotifySound('/sounds/notify.mp3');

        // âœ… Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ…Ø±ÙŠØ±
        window.scrollToMessage = (id) => {
            const el = document.getElementById(id);
            if (el) {
                el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        };

        window.highlightMessage = (id) => {
            const el = document.getElementById(id);
            if (el) {
                el.classList.add('highlight-flash');
                setTimeout(() => {
                    el.classList.remove('highlight-flash');
                }, 2000);
            }
        };
    </script>
</body>
</html>