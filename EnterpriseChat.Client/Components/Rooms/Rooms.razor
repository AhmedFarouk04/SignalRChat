@page "/rooms"
@using EnterpriseChat.Client.ViewModels
@inject RoomsViewModel VM
@inject NavigationManager Nav

<AuthGuard>
    <div class="rooms-page">
        <h2 class="rooms-title">Chats</h2>

        @if (VM.UiError != null)
        {
            <div class="rooms-error">@VM.UiError</div>
        }
        else if (VM.IsLoading)
        {
            <div class="rooms-loading">Loading…</div>
        }
        else if (VM.IsEmpty)
        {
            <div class="rooms-empty">No conversations yet</div>
        }
        else
        {
            <ul class="rooms-list">
                @foreach (var room in VM.Rooms!)
                {
                    <RoomListItem Room="room" OnOpen="Open" />
                }
            </ul>
        }
    </div>
</AuthGuard>

@code {
    protected override async Task OnInitializedAsync()
    {
        await VM.LoadAsync();
    }

    private void Open(Guid roomId)
        => Nav.NavigateTo($"/chat/{roomId}");
}
