@using EnterpriseChat.Client.Models

<div class="topbar">
    @if (Room is null)
    {
        <span class="room-title">Loading…</span>
    }
    else
    {
        <div class="room-header">
            <div class="room-main">
                <div class="room-title">@Title</div>

                <div class="room-sub">
                    @if (IsPrivate && OtherUser != null)
                    {
                        @if (OtherUser.IsOnline)
                        {
                            <span class="dot online"></span>
                            <span>Online</span>
                        }
                        else if (OtherUser.LastSeen != null)
                        {
                            <span>
                                Last seen @OtherUser.LastSeen.Value.ToLocalTime().ToShortTimeString()
                            </span>
                        }
                    }
                    else
                    {
                        <span>@MembersCount members</span>
                    }

                </div>
            </div>

            <div class="room-actions">

                @if (IsPrivate)
                {
                    <button class="icon-btn"
                            title="Block user"
                            @onclick="@(() => OnBlock.InvokeAsync())">
                        🚫
                    </button>
                }

                <button class="icon-btn"
                        title="Mute"
                        @onclick="@(() => OnMuteToggle.InvokeAsync())">
                    @(IsMuted ? "🔔" : "🔕")
                </button>

            </div>


        </div>
    }
</div>

@code {
    [Parameter] public RoomModel? Room { get; set; }
    [Parameter] public int MembersCount { get; set; }
    [Parameter] public UserModel? OtherUser { get; set; }
    [Parameter] public EventCallback OnMuteToggle { get; set; }
    [Parameter] public EventCallback OnBlock { get; set; }
    [Parameter] public bool IsMuted { get; set; }

    private bool IsPrivate => Room?.Type == "Private";

    private string Title =>
        IsPrivate
            ? Room?.OtherDisplayName ?? "Private Chat"
            : Room?.Name ?? "Group";
}
